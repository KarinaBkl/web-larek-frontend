# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные используемые в приложении

Карточка товара

```
interface ICards{
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Массив карточек на главной странице

```
interface ICardssList {
    items: ICards[];
    preview: string | null;
}
```

Информация о товарах в корзине

```
 type IBasket = Pick<ICards, 'title' | 'price'>;
```

Форма ввода данных об адресе и способе доставки

```
interface IPayment {
    pay: string;
    address: string;
}
```

Форма ввода контактных данных покупателя

```
interface IBuyerInfo {
    email: string;
    phone: string;
}
```

Проверка валидации форм

```
 interface IPaymentData {
    CheckValidation(data: Record<keyof IPayment, string>): boolean;
 }
 interface IBuyerInfoData {
    CheckValidation(data: Record<keyof IBuyerInfo, string>): boolean;
}
```

## Архитектура приложения

### Об архитектуре

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:

- `constructor(baseUrl: string, options: RequestInit = {})` - специальный метод в классе который используется для инициализации новых объектов, создаваемых этим классом.

  - `baseUrl: string` - адрес сервера.
  - `options: RequestInit = {}` - объект с заголовками запросов.

- `handleResponse` - предназначен для обработки ответа на HTTP-запрос.
  - ответ успешен, метод возвращает распарсенный ответ.
  - ответ не успешен, метод возвращает ответ содержащий информацию об ошибке из тела ответа.
- `GET` - выполняет GET запрос на переданный в параметрах Endpoint и возвращает Promise с объектом, которым ответил сервер.
- `POST` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на Endpoint переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящее в системе. Класс используется в Presenter для обработки событий и в слоях приложения для генерации событий. Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `constructor` - инициализирует пустую переменную
- `on` - подписка на событие
- `off `- снять обработчик с события
- `emit` - инициализация события с данными
- `onAll `- Слушать все события
- `offAll` - Сбросить все обработчики
- `trigger` - Сделать callback триггер, генерирующий событие при вызове

### Слой данных

#### Класс AppState

Класс отвечает за хранение и логику работы с данными приложения.Методы класса позволяют управлять этими данными, например, добавлять/удалять товары из корзины, проверять данные форм, очищать корзину и т.д.

В полях класса хранятся следующие данные:

- `catalog: IProduct[]` - массив карточек продуктов
- `preview: string | null` - просмотр подробной информации о продукте
- `basket: IProduct[]` - товары, добавленные пользователем в корзину
- `order: IShoppingInfo` - информация о заказе
- `orderErrors: IFormError` - сообщение об ошибке при вводе данных в форме
- `formType: 'order' | 'contacts'` - тип формы

Методы:

- `setProductList()` - вывод списка продуктов
- `addToBasket()` - добавление товара в корзину
- `deleteFromBasket()` - удаление товара из корзины
- `isInBasket()` - получение списка товаров в корзине
- `getNumberBasket()` - вывод количества товаров в корзине
- `getTotalBasket()` - вывод итоговой стоимости товаров в корзине
- `cleanBasket()` - очищаение корзины
- `getTotalBasket()` - отображение суммы всех товаров в корзине
- `setField()` - ввод данных в поле заказа
- `setOrderErrors()` - проверка данных адреса и способа оплаты для заказа
- `setContactsErrors()` - проверка данных email и номера телефона для заказа
- `clearErrors()` - очищение сообщений о ошибках форм

#### Класс Product

Класс, который отвечает за хранение и обработку данных о продукте, является наследником абстрактного класса Component. Конструктор этого класса также наследуется от абстрактного класса Component. Методы класса позволяют управлять этими данными.

В полях класса хранятся следующие данные:

- `id: string` - уникальный номер товара
- `description: string` - описание товара
- `image: string` - изображение товара
- `title: string` - наименование товара
- `category: string` - категория, к которой относится товар
- `price: number` - стоимость товара

Методы:

- `getId()` - получение уникального номера
- `setId()` - установка уникального номера
- `setTitle()` - установка наименования товара
- `setPrice()` - установка стоимости товара
- `setDescription()` - установка описания товара
- `setCategory()` - установка категории товара
- `setImage()` - установка изображения товара
- `setinBasket()` - установка значения добавленности в корзину
- `setIndex()` - установка индекса

#### Класс SendApi

Наследуется от класса Api. Используется для вывода карточек товаров на странице, а также и отправки заказа. Он содержит методы для получения данных о продуктах и отправки заказа на сервер.

Конструктор:

- `constructor(cdn: string, baseUrl: string, options: RequestInit = {})`

Поля класса:

- `cdn: string` - используется для формирования полного пути к изображениям продуктов

Методы:

- `getProductItem(id: string): Promise<IProduct>` - получает данные о продукте по его ID и добавить полный URL изображения
- `getProductList(): Promise<IProduct[]>` - получает список продуктов и добавить полный URL изображения для каждого продукта
- `postOrder(orderData: IShoppingPost): Promise<ISuccessfulOrder>` - отправляет данные заказа на сервер и вернуть результат

### Слой представления

#### Класс Component

Абстрактный класс является базовым для всех компонентов приложения. Он содержит основные методы для управления отображением элементов на странице. Конструктор класса принимает DOM-элемент контейнера, в который будет отрисовываться компонент.

Конструктор:

- `constructor(protected readonly container: HTMLElement)` - конструктор принимает принимает DOM-элемент

- `container: HTMLElement` - DOM-элемент контейнера

Методы:

- `toggleClass` - переключение класса
- `setDisable` - деактивация кнопок
- `setActive` - активация кнопок
- `setHidden` - скрытие элемента
- `setVisible` - отображение элемента
- `setText` - установка текста
- `setImage` - установка изображения
- `render` - Отображение данных.

#### Класс Page

Реализует отобржение корзины с количеством товара в ней и массив карточек товаров. Класс наследуется от абстрактного класса Component.. Он содержит поля counter, catalog, basket и wrapper для хранения соответствующих элементов DOM. Методы класса управляют отображением этих элементов.

Конструктор наследуется от абстрактного класса Component.

Поля класса:

- `counter: number` - счетчик элементов в корзине
- `catalog: HTMLElement` - массив карточек товаров
- `basket: HTMLElement` - корзина с выбранными товарами
- `wrapper: HTMLElement` - главная страница интернет-магазина

Методы класса:

- `counter()` - управление отображением количества товаров в корзие
- `catalog()` - управление массивом карточек
- `locked()` - управление блокировкой для прокрутки при открытии модального окна

#### Класс Modal

Реализует модальное окно, содержит методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по клику на оверлей или крестик. Класс наследуется от абстрактного класса Component

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)` - наследуется от абстрактного класса Component

Поля класса:

- `container: HTMLElement` - переключает модального окна
- `events: IEvents` - брокер событий
- `content: HTMLElement` - контент, находящийся в модальном окне
- `closeButton: HTMLButtonElement`- кнопка закрытия модального окна

Методы класса:

- `toggleModal()` - присваивает контен модальному окну
- `set content()` - присваивает контен модальному окну
- `set content()` - присваивает контен модальному окну
- `open()` - управляет отображением модального окна - показывает на странице
- `close()` - управляет отображением модального окна - скрывает со страницы
- `render()` - наследует и расширяет метод родительского класса. Возвращает заполненный данными корневой DOM-элемент

#### Класс Basket

Класс отвечает за работу с корзиной, пользователя. Расширяет класс Component. Предназначен для реализации модального окна с формой, содержащей информацию о выбранных для оформления товарах. При сабмите инициирует событие подтверждения данных и переходу к оформлению заказа.

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)` - наследуется от абстрактного класса Modal

Поля класса:

- `orderButton: HTMLButtonElement` - кнопка подтверждения
- `list: HTMLElement[]` - коллекция всех выбранных товаров
- `total: string` - сумма для оплаты

Методы:

- `get list()` - получение списка выбранных товаров
- `set List()` - вывод списка выбранных товаров
- `set total()` - вывод общей стоимости товаров

#### Класс ModalInformation

Реализует модальное окно для ввода данных для оформления заказа. Он содержит поля для хранения кнопки подтверждения, элементов для вывода ошибок и коллекции полей ввода формы. Методы класса управляют отображением ошибок и очисткой формы. Класс наследуется от абстрактного класса Component.

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)` - наследуется от абстрактного класса Component

Поля класса:

- `submitButton: HTMLButtonElement` - кнопка подтверждения
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
- `inputs: NodeListOf<HTMLInputElement>` - коллекции всех полей ввода формы

Методы:

- `setError()` - принимает объект с данными для отображения или скрытия ошибок под полями ввода
- `showInputError()`- отображает полученный текст ошибки под указанным полем ввода
- `hideInputError()` - скрывает текст ошибки под указанным полем ввода
- `clearModal()` - очищает поля формы и сбрасывает состояния кнопок при сабмите

#### Класс OrderForm

Предназначен для реализации модального окна с формой, содержащей поле ввода адреса и способов оплаты заказа. При сабмите инициирует событие подтверждения данных для отправки и оплаты заказа. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Наследуется от класса ModalInformation.

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)` - конструктор наследуется от абстрактного класса ModalForOrder

Поля класса:

- `PaymentButton: HTMLButtonElement` - кнопка выбора способа оплаты
- `address: HTMLInputElement` - элемент формы для ввода адреса

Методы:

- `set address()` - устанавливает значение в поле адреса
- `set payment()` - переключает выбранную пользователем кнопку выбора способа оплаты

#### Класс ContactForm

Предназначен для реализации модального окна с формой, содержащей поля ввода email и телефона. При сабмите инициирует событие подтверждения данных и переход на окно с уведомлением об успешном оформлении заказа. Наследуется от класса ModalInformation.

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)`

Поля класса:

- `email: HTMLInputElement` - поле ввода эмейла
- `phone: HTMLInputElement` - поле ввода номера телефона

Методы:

- `set email()` - устанавливает значение в поле почтового адреса
- `set phone()` - устанавливает значение в поле контактного телефона

#### Класс SuccessForm

Наследуется от класса Component. Предназначен для реализации модального окна с формой, содержащей сообщение об успешном оформлении заказа, в которое передаётся полная стоимость корзины.

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)`

Поля класса:

- `closeButton: HTMLButtonElement` - кнопка закрытия формы при успешном оформлении заказа
- `total: number` - общая сумма покупки
- `description: HTMLElement` - сообщение об успешном оформлении заказа

Методы:

- `set total()` - устанавливает значение в поле общей суммы заказа

### Слой коммуникации

### Взаимодействие компнонетов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`. Взаимодействие осуществляется за счет событий, генерируемых с помощью броекера событий и их обработчиков.

Список событий, которые могут генерироваться в системе

- `product:select` - при клике на товар всплывает модальное окно с подробной информацией о товаре и возможностью добавления товара в корзину
- `product:add` - добавление продукта в корзину
- `product:remove` - при клике на кнопку удаления товара в корзине
- `basket:open `- открытие корзины
- `form:validation` - валидация введеных пользовательских данных
- `formErrors:change` - событие, сообщающее о необходимости валидации форм с вводом адреса и способа оплаты и с контактными данными
- `success:finish` - окно успешного оформления заказа
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
